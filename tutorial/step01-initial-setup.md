# Шаг 1: Первоначальная настройка

Прежде чем мы сможем начать работу над нашим плагином, мы должны сначала убедиться, что у нас есть подходящая среда разработки.

## Настройка среды разработки
Для разработки понадобится следующий набор ПО:
* Виртуализация [VirtualBox](https://www.virtualbox.org/) (или любая другая привычная вам)
* Любой редактор или среда разработки, имеющая плагин/функционал работы с git репозиториями ([Atom](https://github.com/atom/atom), [Sublime Text](http://www.sublimetext.com/3), [PyCharm](https://www.jetbrains.com/pycharm/download/?section=windows))
* Удобные инструменты командной строки (не обязательно), например [Git for Windows](https://gitforwindows.org/) содержит Git BASH
* Образ [Ubuntu 22.04](https://releases.ubuntu.com/22.04.3/ubuntu-22.04.3-live-server-amd64.iso?_ga=2.222831643.1000254876.1700472990-1157606760.1700472990) или [CentOS](http://isoredirect.centos.org/centos/7/isos/x86_64/)

Необходимо создать ВМ, желательно 2 vcpu, 2 гб оперативной памяти и 30 гб диска. Установить базовую операционную систему и настроить  директорию `/opt/netbox` как общую папку с хостовой системой (для удобства разработки и обновлений), соответственно на [шаге 3](https://docs.netbox.dev/en/stable/installation/3-netbox/) установки, вместо загрузки в ВМ надо скачать архив в общую папку на хостовой машине.


### Установите NetBox

Для разработки плагина требуется локальная установка NetBox. Если у вас еще не установлен NetBox, пожалуйста, ознакомьтесь с [инструкциями по установке](https://netbox.readthedocs.io/en/stable/installation/).

Обязательно включите отладку в вашей конфигурации NetBox, установив `DEBUG = True`. Это гарантирует, что статические ресурсы могут обслуживаться сервером разработки, и возвращает полную обратную трассировку всякий раз, когда возникает ошибка сервера.

:green_circle: **Совет:** Если эта установка предназначена только для использования в разработке, обычно необходимо выполнить только до третьего шага руководства по установке, завершающегося успешным запуском сервера разработки NetBox (`manage.py runserver`).

:warning: **Предупреждение:** Для данного руководства требуется NetBox версии 3.2 или более поздней. Попытка использовать более раннюю версию NetBox не сработает..

### Склонируйте репозиторий

Далее мы клонируем демонстрационный репозиторий git с GitHub. Сначала переместитесь с помощью `cd` в предпочитаемое вами местоположение (вероятно, подойдет ваш домашний каталог), затем клонируйте репозиторий с помощью `git clone`. Мы переключаемся на ветку `init`, которая предоставит нам пустое рабочее пространство для запуска.

```bash
$ git clone --branch step00-empty https://github.com/netbox-community/netbox-plugin-demo
Cloning into 'netbox-plugin-demo'...
remote: Enumerating objects: 58, done.
remote: Counting objects: 100% (58/58), done.
remote: Compressing objects: 100% (42/42), done.
remote: Total 58 (delta 12), reused 58 (delta 12), pack-reused 0
Unpacking objects: 100% (58/58), done.
```

:blue_square: **Примечание:** Клонировать демонстрационный репозиторий не обязательно, но это позволит вам удобно просматривать снимки кода по мере прохождения уроков и устранять любые сбои.

## Конфигурация плагина

### Создать `__init__.py`

Класс `PluginConfig` содержит всю информацию, необходимую для установки нашего плагина. Сначала мы создадим подкаталог для хранения кода наших плагинов на Python, а также `__init__.py ` файл для хранения определения `PluginConfig`.

```bash
$ mkdir netbox_access_lists
$ touch netbox_access_lists/__init__.py
```

Затем откройте `__init__.py ` в текстовом редакторе по вашему выбору и импортируйте класс PluginConfig из NetBox в верхней части файла.

```python
from extras.plugins import PluginConfig
```

### Создайте класс "Plugin Config"

Мы создадим новый класс с именем `NetBoxAccessListsConfig`, создав подкласс `PluginConfig`. Это определит все необходимые параметры, которые управляют конфигурацией нашего плагина после установки. Есть [много необязательных атрибутов](https://netbox.readthedocs.io/en/stable/plugins/development/#pluginconfig-attributes), которые можно задать здесь, но пока нам нужно определить только несколько.

```python
class NetBoxAccessListsConfig(PluginConfig):
    name = 'netbox_access_lists'
    verbose_name = ' NetBox Access Lists'
    description = 'Manage simple ACLs in NetBox'
    version = '0.1'
    base_url = 'access-lists'
```

Этого будет достаточно для последующей установки нашего плагина в NetBox. Наконец, нам нужно указать этот класс как "config", чтобы гарантировать, что NetBox обнаружит его. Добавьте эту строку в конец файла:

```python
config = NetBoxAccessListsConfig
```

## Создайте README

Считается лучшей практикой всегда включать файл `README` в любой публикуемый вами код. Это краткий фрагмент документации, который объясняет цель вашего проекта, как его установить / запустить, где найти справку и т.д. Поскольку это всего лишь учебное упражнение, нам нечего особо сказать о нашем плагине, но все равно продолжайте и создайте файл.

Вернитесь в корневой каталог проекта (на один уровень выше `__init__.py`), создайте файл с именем `README.md` и введите следующее содержимое:

```markdown
## netbox-access-lists

Manage simple access control lists in NetBox
```
:green_circle: **Совет:** Вы заметите, что мы присвоили нашему файлу `README` расширение `md`. Это указывает инструментам, которые его поддерживают, отобразить файл в формате Markdown для лучшей читаемости

## Установите плагин

### Создайте `setup.py``

Чтобы включить установку нашего плагина в виртуальную среду, которую мы создали выше, мы создадим простой скрипт установки на Python. В корневом каталоге проекта создайте файл с именем `setup.py` и введите приведенный ниже код.
```python
from setuptools import find_packages, setup

setup(
    name='netbox-access-lists',
    version='0.1',
    description='An example NetBox plugin',
    install_requires=[],
    packages=find_packages(),
    include_package_data=True,
    zip_safe=False,
)
```

:warning: **Предупреждение:** Создайте `setup.py ` в корне проекта и _не_ в каталоге `netbox_access_lists`.

Этот файл вызовет функцию `setup()`, предоставляемую Python [`setuptools`](https://packaging.python.org/en/latest/guides/distributing-packages-using-setuptools/) библиотеки для установки нашего кода. Существует множество дополнительных аргументов, которые могут быть переданы, но для нашего примера этого достаточно.

:green_circle: **Совет:** Существуют альтернативные методы установки кода на Python, которые работают так же хорошо; не стесняйтесь использовать свой предпочтительный подход. Просто имейте в виду, что в этом руководстве предполагается использование "setuptools".

###  (Опционально, зависит от типа инсталляции) Активируйте виртуальную среду

Чтобы убедиться, что наш плагин доступен для установки NetBox, нам сначала нужно активировать Python [виртуальную среду](https://docs.python.org/3/library/venv.html ), которая была создана, когда мы устанавливали NetBox. Чтобы сделать это, определите путь к виртуальной среде (это будет `/opt/netbox/venv/`, если вы используете значения по умолчанию в документации) и активируйте его:

```bash
$ source /opt/netbox/venv/bin/activate
```

### Запустить `setup.py `

Теперь мы можем установить наш плагин, запустив `setup.py`. Сначала убедитесь, что виртуальная среда все еще активна, затем запустите следующую команду из корневого каталога проекта. Аргумент `develop` указывает `setuptools` создать ссылку на наш локальный путь разработки вместо копирования файлов в виртуальную среду. Это позволяет избежать необходимости переустанавливать плагин каждый раз, когда мы вносим изменения.

```bash
$ python3 setup.py develop
running develop
running egg_info
creating netbox_access_lists.egg-info
writing manifest file 'netbox_access_lists.egg-info/SOURCES.txt'
writing manifest file 'netbox_access_lists.egg-info/SOURCES.txt'
running build_ext
```

### Настройка NetBox

Наконец, нам нужно настроить NetBox для включения нашего нового плагина. В пути установки NetBox откройте "netbox/netbox/configuration".py` и найдите параметр `PLUGINS`; это должен быть пустой список. (Если он еще не определен, продолжайте и создайте его.) Добавьте название нашего плагина в этот список:

```python
# configuration.py
PLUGINS = [
    'netbox_access_lists',
]
```

Сохраните файл и запустите сервер разработки NetBox (если он еще не запущен):

```bash
$ python netbox/manage.py runserver
```

Вы должны увидеть успешный запуск сервера разработки. Откройте окно "Сеть" в новом окне браузера, войдите в систему как суперпользователь и перейдите в пользовательский интерфейс администратора. В разделе **Система > Установленные плагины** вы должны увидеть список наших плагинов.

![Django admin UI: Plugins list](/images/step01-django-admin-plugins.png)

:green_circle: **Совет:** Вы можете проверить свою работу в конце каждого шага в руководстве, запустив `git diff` для соответствующей ветви. Например, в конце первого шага запустите "git diff remotes/origin/step01-initial-setup", чтобы сравнить свою работу с завершенным шагом. Это поможет определить все задачи, которые вы, возможно, пропустили.

На этом наша первоначальная настройка завершена. Теперь перейдем к самому интересному!

<div align="center">

[Шаг 2: Модели](/tutorial/step02-models.md) :arrow_right:

</div>

